{% extends "layout.html" %}

{% block form_tambah %}
<div class="col-md-12 mb-3">
  <label for="id_mapel">Mata Pelajaran</label>
  <select name="id_mapel" class="form-control" required>
    {% for m in daftar_mapel %}
    <option value="{{ m.id_mapel }}">{{ m.nama_mapel }}</option>
    {% endfor %}
  </select>
</div>

<div class="col-md-12 mb-3">
  <label for="id_pembagian">Kelas</label>
  <select name="id_pembagian" class="form-control" required>
    {% for k in daftar_kelas %}
    <option value="{{ k.id_kelas }}">{{ k.nama_kelas }}</option>
    {% endfor %}
  </select>
</div>

<div class="col-md-12 mb-3">
  <label for="id_semester">Semester</label>
  <select name="id_semester" class="form-control" required>
    {% for s in daftar_semester %}
    <option value="{{ s.id_semester }}">{{ s.semester }}</option>
    {% endfor %}
  </select>
</div>

<div class="col-md-12 mb-3">
  <label for="id_tahun_akademik">Tahun Akademik</label>
  <select name="id_tahun_akademik" class="form-control" required>
    {% for t in daftar_tahun %}
    <option value="{{ t.id_tahun_akademik }}">{{ t.tahun_akademik }}</option>
    {% endfor %}
  </select>
</div>
{% endblock %}

{% block content %}
<div class="page-titles">
  <div class="row">
    <div class="col-lg-8 col-md-6 col-12 align-self-center">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0 d-flex align-items-center">
          <li class="breadcrumb-item"><a href="/" class="link"><i class="ri-home-3-line fs-5"></i></a></li>
          <li class="breadcrumb-item active" aria-current="page">Data {{title}}</li>
        </ol>
      </nav>
      <h1 class="mb-0 fw-bold">Data {{title}}</h1>
    </div>
    {% if btn_tambah %}
    <div class="col-lg-4 col-md-6 d-md-flex align-items-center justify-content-end">
      <button type="button" class="btn btn-info d-flex align-items-center ms-2" data-bs-toggle="modal" data-bs-target="#tambahModal">
        <i class="ri-add-line me-1"></i> Tambah Data
      </button>
    </div>
    {% endif %}
  </div>
</div>

<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <h4>Daftar Pelajaran</h4>
          <div class="table-responsive">
            <table id="myTable" class="table table-striped">
              <thead>
                <tr>
                  <th>No</th>
                  <th>Nama Guru</th>
                  <th>Mata Pelajaran</th>
                  <th>Nama Siswa</th>
                  <th>Kelas</th>
                  <th>Semester</th>
                  <th>Tahun Akademik</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody>
                {% for a in data_ampu %}
                <tr>
                  <td>{{ loop.index }}</td>
                  <td>{{ a.guru_rel.nama }}</td>
                  <td>{{ a.mapel_rel.nama_mapel }}</td>
                  <td>{{ a.semester_rel.semester }}</td>
                  <td>{{ a.tahun_akademik_rel.tahun_akademik }}</td>
                  <td>
                      <button type="button" class="btn btn-success" onclick="openKehadiranModal('{{ a.id_ampu }}')">Kehadiran</button>
                      <button type="button" class="btn btn-warning" onclick="openEditModal('{{ a.id_ampu }}')">Edit</button>
                      <button type="button" class="btn btn-danger" onclick="deleteData('{{ a.id_ampu }}')">Hapus</button>
                  </td>
                </tr>
                <!-- Modal Edit -->
                <div class="modal fade" id="editModal-{{ a.id_ampu }}" tabindex="-1" aria-labelledby="editLabel" aria-hidden="true">
                  <div class="modal-dialog  modal-lg"> 
                  <div class="modal-content">
                    
                    <!-- Modal Header -->
                    <div class="modal-header">
                    <h5 class="modal-title" id="editLabel">Edit {{title_data}}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
                    </div>

                    <!-- Modal Body -->
                    <div class="modal-body">
                    <form id="editForm-{{ a.id_ampu }}">
                        <input type="hidden" name="id_semester_old" value="{{ a.id_ampu }}">
                        <label>id_semester: </label><input type="text" name="id_semester" value="{{ a.id_ampu }}" class="form-control mb-3">
                        <label>Nama Semester:</label> <input type="text" name="nama_semester" value="{{ a.id_ampu }}" class="form-control mb-3" required>
                        
                      <div class="modal-footer"><button type="submit" id="tombol-edit-{{ a.id_ampu }}" class="btn btn-success">Simpan</button>
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                      </div>
                      
                    </form>
                    </div>
                  </div>
                  </div>
                </div>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
 <!-- Modal Kehadiran -->
<div class="modal fade" id="kehadiranModal" tabindex="-1" aria-labelledby="kehadiranLabel" aria-hidden="true">
  <div class="modal-dialog  modal-lg"> 
  <div class="modal-content">
    
    <!-- Modal Header -->
    <div class="modal-header">
    <h5 class="modal-title" id="kehadiranLabel"></h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
    </div>
    <!-- Modal Body -->
    <div class="modal-body">
    <form id="kehadiranForm">
        
      <div class="modal-footer"><button type="submit" id="tombol-kehadiran" class="btn btn-success">Simpan</button>
      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
      </div>
      
    </form>
    </div>
  </div>
  </div>
</div>
<script>$('#myTable').DataTable();</script>
{% endblock %}
